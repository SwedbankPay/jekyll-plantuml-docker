#!/bin/bash

[ "${DEBUG:-false}" = "true" ] && set -x

# This config comes from Nokogiri error output as a suggestion
bundle config build.nokogiri --use-system-libraries

bundle check || bundle install

if [[ "$1" == "deploy" ]]; then
  echo "Deploying..."
  bundle exec jekyll build JEKYLL_ENV=production --verbose
  exec /usr/jekyll/bin/deploy.sh --verbose
elif [[ -z "$*" ]]; then
  echo "Running default command 'jekyll serve'..."
  exec bundle exec jekyll serve --livereload --incremental --force_polling --watch --host 0.0.0.0
else
  echo "Running: $*"
  exec "$@"
fi
